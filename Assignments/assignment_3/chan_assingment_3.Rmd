---
title: "chan_assignment_3"
author: "Delores Chan"
date: "2024-02-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(janitor)
library(ggplot2)
library(purrr)
```

## assignment page: https://louisgraup.github.io/ESM_262_Programming/topic_5_resource.html

```{r}
# bring in autopower function
source("C:/Users/delor/OneDrive/Desktop/ESM_262/R/fuel_effic.R")
```

## Add an additional super light car with mass 5,000 kg and a surface area 10m2
```{r}
# from looping.rmd: generate a structure to store info on our possible cars, add an additional car
# car "D" is 5,000 kg with a surface area of 10m2
possible_cars = data.frame(name = c("A","B","C","D"),mass=c(10000,65000,38000, 5000), area = c(22,30,22, 10))

# converting average speed 
# recall our function needs speed in m/s not km/hr so we will also do a conversion
speed_base <- 80*.28 

possible_cars$power = autopower(V=speed_base, m=possible_cars$mass, A=possible_cars$area)

head(possible_cars)


# computing and converting average speed with sd 
mean_speed <- log(speed_base) 

nspeeds<- 300

speeds <- rlnorm(mean=mean_speed, sd=0.1*mean_speed, nspeeds)

summary(speeds)
```

## Compute the mean and maximum power for Cars A, B, C and for your new car, assuming that average highway speed is 80 km/hr with a standard deviation of 10km/hr; Use 2 different methods to compute the mean and maximum power for each car type; a) FOR loop and b) the pmap function from purr


### Calculating Mean using a for loop 
```{r}
#create a new df to store all the speeds 
power_all_cars_mean = as.data.frame(matrix(nrow=length(speeds), ncol=nrow(possible_cars)))
head(power_all_cars_mean)

```

```{r}
# using a for loop to calculate the mean power for each car 

   for (i in 1:nrow(possible_cars)) {
  power_all_cars_mean[,i] = autopower(V=speeds, m=possible_cars$mass[i], A=possible_cars$area[i])
   }


head(power_all_cars_mean)
#rename
colnames(power_all_cars_mean)=possible_cars$name
```

### Calculating max power using a for loop  
```{r}
# new data frame to store max power
 # we've found the mean power over a range of speeds, now we find max of each car over our 300 iterations 
 # only one row because it is the same max speed across the 300 
power_all_cars_max <- as.data.frame(matrix(nrow = 1, ncol = nrow(possible_cars)))
```

```{r}
# Using a for loop to calculate the maximum power for each car

for (i in 1:nrow(possible_cars)) {
  power_all_cars_max[, i] = autopower(V = max(speeds), m = possible_cars$mass[i], A = possible_cars$area[i])
}

# Rename columns
colnames(power_all_cars_max) <- possible_cars$name

# Display the result
head(power_all_cars_max)
```


### Using pmap to calculate mean power 

```{r}
# pmap runs a function for each value in a list of parameters, with other parameters set for each iteration
power_all_cars_mean2 = pmap(list(A = possible_cars$area, m=possible_cars$mass), autopower, V=speeds)

# turn this into a df 
power_all_cars_mean2 <- as.data.frame(power_all_cars_mean2, col.names=possible_cars$name)
```


### Using pmap to calculate max power 
```{r}
# pmap runs a function for each value in a list of parameters, with other parameters set for each iteration
power_all_cars_max2 = pmap(list(A = possible_cars$area, m=possible_cars$mass), autopower, V=max(speeds))

# turn this into a df 
power_all_cars_max2 <- as.data.frame(power_all_cars_max2, col.names=possible_cars$name)
```




## Create two boxplots (one for each method (FOR and pmap)) that show the range of power consumption (across sampled speeds) for each car type.

```{r}
# for loop box plot

# clean up data frames
colnames(power_all_cars_mean)=possible_cars$name
head(power_all_cars_mean)

cleaned_power_all_cars = power_all_cars_mean %>% pivot_longer(cols=everything(), names_to="car", values_to="power")
head(cleaned_power_all_cars)

colnames(power_all_cars_max)=possible_cars$name
head(power_all_cars_max)
cleaned_max_power = power_all_cars_max %>%  pivot_longer(cols=everything(), names_to="car", values_to="power")
head(cleaned_max_power)


# mean plot
for_mean_plot <- ggplot(cleaned_power_all_cars, aes(car, power, fill = car)) +
  geom_boxplot() +
  ggtitle("Using for loop to calculate average power")

for_mean_plot
```

```{r}
# pmap box plot

# clean up data frames
colnames(power_all_cars_mean2)=possible_cars$name
head(power_all_cars_mean2)
cleaned_power_all_cars2 = power_all_cars_mean2 %>% pivot_longer(cols=everything(), names_to="car", values_to="power")
head(cleaned_power_all_cars2)


# plot
pmap_plot = ggplot(cleaned_power_all_cars2, aes(car,power, fill=car))+geom_boxplot()+ggtitle("Using pmap to calculate average power")
pmap_plot
```



```{r}
ggarrange(for_mean_plot, pmap_plot)
```

